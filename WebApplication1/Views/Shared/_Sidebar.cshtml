@inject Microsoft.Extensions.Localization.IStringLocalizer<SharedResource> S
@{   

    // 현재 URL에 따라 초기 펼침 상태 결정
    var path = (Context.Request.Path.Value ?? "").ToLowerInvariant();
    bool isApprovalOpen =
        path.StartsWith("/approval");

    bool isSettingsOpen =
        path.StartsWith("/identity/account/changeprofile")
        || path.StartsWith("/role")
        || path.StartsWith("/mfa")
        || path.StartsWith("/adminuserprofile");
}

<!-- <nav id="sidebar-accordion" class="nav flex-column vh-100 bg-dark text-light px-0">-->
<nav id="sidebar-accordion" class="nav flex-column bg-dark text-light px-0">

    <!-- 전자결재 -->
    <a class="nav-link collapse-toggle @(isApprovalOpen ? "" : "collapsed")"
       data-bs-toggle="collapse" href="#approvalSubMenu" role="button"
       aria-expanded="@(isApprovalOpen.ToString().ToLower())" aria-controls="approvalSubMenu">
        <img src="~/images/sidebar1-approval.png" alt="@(S["Sidebar_Menu1"])" width="36" height="36" class="me-2 flex-shrink-0" />
        <span class="menu-text">@S["Sidebar_Menu1"]</span>
        <i class="bi bi-chevron-down toggle-icon"></i>
    </a>

    <div id="approvalSubMenu"
         class="collapse @(isApprovalOpen ? "show" : "")"
         data-bs-parent="#sidebar-accordion">
        <!--<a asp-area="" asp-controller="Approval" asp-action="Write" class="nav-link d-flex align-items-center">
            <img src="~/images/sidebar2-write.png" alt="@(S["Sidebar_Menu1Sub1"])" width="36" height="36" class="me-2" />
            
            <span>@S["Sidebar_Menu1Sub1"]</span>
        </a>-->
        <a asp-area="" asp-controller="Document" asp-action="Report"
           class="nav-link d-flex align-items-center">
            <img src="~/images/sidebar2-write.png"
                 alt="@(S["Sidebar_Menu1Sub1"])" width="36" height="36" class="me-2" />
            <span>@S["Sidebar_Menu1Sub1"]</span>
        </a>

        <a asp-area="" asp-controller="Approval" asp-action="Approve" class="nav-link d-flex align-items-center">
            <img src="~/images/sidebar2-approval.png" alt="@(S["Sidebar_Menu1Sub2"])" width="36" height="36" class="me-2" />
            <span>@S["Sidebar_Menu1Sub2"]</span>
        </a>
        <a asp-area="" asp-controller="Approval" asp-action="Shared" class="nav-link d-flex align-items-center">
            <img src="~/images/sidebar2-share.png" alt="@(S["Sidebar_Menu1Sub3"])" width="36" height="36" class="me-2" />
            <span>@S["Sidebar_Menu1Sub3"]</span>
        </a>
    </div>

    <!-- 게시판 -->
    <a asp-area="" asp-controller="Board" asp-action="Index" class="nav-link d-flex align-items-center">
        <img src="~/images/sidebar1-bbs.png" alt="@(S["Sidebar_Menu2"])" width="36" height="36" class="me-2" />
        <span>@S["Sidebar_Menu2"]</span>
    </a>

    <!-- 설정 (토글) 
    <a class="nav-link d-flex align-items-center @(isSettingsOpen ? "" : "collapsed")"-->
    <a class="nav-link w-100 d-flex align-items-center @(isSettingsOpen ? "" : "collapsed")"
       data-bs-toggle="collapse"
       href="#settingsSubMenu"
       role="button"
       aria-expanded="@(isSettingsOpen.ToString().ToLower())"
       aria-controls="settingsSubMenu">
        <img src="~/images/sidebar1-setting.png" alt="@(S["Sidebar_Menu3"])" width="36" height="36" class="me-2" />
        <span class="flex-grow-1">@S["Sidebar_Menu3"]</span>
        <!--<i class="bi bi-chevron-down toggle-icon"></i> -->
        <i class="bi bi-chevron-down toggle-icon ms-auto"></i>
    </a>

    <div id="settingsSubMenu"
         class="collapse @(isSettingsOpen ? "show" : "")"
         data-bs-parent="#sidebar-accordion">

        <!-- 사용자 설정 (Identity Razor Page) -->
        <a asp-area="Identity" asp-page="/Account/ChangeProfile" class="nav-link d-flex align-items-center">
            <img src="~/images/sidebar2-usersetting.png" alt="@(S["Sidebar_Menu3Sub1"])" width="36" height="36" class="me-2" />
            <span>@S["Sidebar_Menu3Sub1"]</span>
        </a>
        <a asp-area="" asp-controller="DocTL" asp-action="Index"
           class="nav-link d-flex align-items-center">
            <img src="~/images/sidebar2-DocTemplete.png"
                 alt="@(S["Sidebar_Menu3Sub2"])"
                 width="36" height="36" class="me-2" />
            <span>@S["Sidebar_Menu3Sub2"]</span>
        </a>

        <!-- 2단계 인증 (루트 MVC 컨트롤러) -->
        <a asp-area="" asp-controller="Mfa" asp-action="Setup" class="nav-link d-flex align-items-center mb-2">
            <img src="~/images/sidebar2-user2fa.png" alt="@(S["Sidebar_Menu3Sub3"])" width="36" height="36" class="me-2" />
            <span>@S["Sidebar_Menu3Sub3"]</span>
        </a>

        @* 관리자만 노출 *@
        @if (User.HasClaim("is_admin", "1") || User.HasClaim("is_admin", "2"))
@*         {
            <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "AdminUserProfile" ? "active" : "")"
               asp-area="" asp-controller="AdminUserProfile" asp-action="Index">
                <img src="~/images/sidebar2-usermanage.png"
                     alt="@(S["Sidebar_Menu3Sub4"])"
                     width="36" height="36" class="me-2" />
                <span>@S["Sidebar_Menu3Sub4"]</span>
            </a>
        } *@

        {
            <a class="nav-link @(string.Equals(ViewContext.RouteData.Values["page"] as string, "/Admin/AdminUserProfile", StringComparison.OrdinalIgnoreCase) ? "active" : "")"
               asp-area="Identity" asp-page="/Admin/AdminUserProfile">
                <img src="~/images/sidebar2-usermanage.png"
                     alt="@(S["Sidebar_Menu3Sub4"])"
                     width="36" height="36" class="me-2" />
                <span>@S["Sidebar_Menu3Sub4"]</span>
            </a>
        }

        <!-- 권한 설정 (루트 MVC 컨트롤러) -->
        <a asp-area="" asp-controller="Role" asp-action="Index" class="nav-link d-flex align-items-center">
            <img src="~/images/sidebar2-authoritysetting.png" alt="@(S["Sidebar_Menu3Sub5"])" width="36" height="36" class="me-2" />
            <span>@S["Sidebar_Menu3Sub5"]</span>
        </a>
    </div>
</nav>
